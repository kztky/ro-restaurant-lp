// ==================
// I18N DATA
// ==================
const i18n = {
  ja: {
    'nav.concept': 'コンセプト', 'nav.menu': 'メニュー', 'nav.space': '空間',
    'nav.access': 'アクセス', 'nav.reserve': 'Reservation',
    'hero.eyebrow': '青森 — Aomori',
    'hero.desc': '短い夏に凝縮された、津軽の旨みがある。\n炭火がゆっくりと、雪解けのように解く。\n素材が語る言葉に、ただ耳を傾ける夜。',
    'hero.cta': '物語を読む',
    'concept.label': '— Our Philosophy',
    'concept.title': '火と菌が\nつくる、時間',
    'concept.p1': '津軽炭火の遠赤外線が素材の細胞を穏やかに開き、長期発酵が引き出した旨みと重なる瞬間がある。それは料理ではなく、時間の結晶だと私たちは考えます。',
    'concept.p2': '青森の山と海が育てた食材だけを使い、添加物を一切使わない発酵調味料で仕上げる。シンプルであるほど、素材の記憶が鮮明になる。',
    'concept.caption': '津軽備長炭、800℃の静寂',
    'menu.subtitle': 'Omakase Menu', 'menu.title': 'おまかせ献立',
    'menu.link': 'Full Menu →',
    'menu.preview_hint': '献立にカーソルを合わせると\n詳細がご覧いただけます',
    'menu.hover_hint': 'カーソルを合わせると詳細が開きます',
    'menu.course': 'その時々の旬の食材を使ったおまかせコース、6品 ¥30,000（税込）。ドリンクペアリングや食材のご要望はご予約時にご相談ください。',
    'space.subtitle': 'Space & Atmosphere', 'space.title': '空間について',
    'space.p1': '炉を囲む、カウンター席', 'space.p2': '青森の山と海から',
    'space.p3': '津軽備長炭の火', 'space.p4': '発酵と炭火の交差点',
    'info.label': '— Restaurant Info',
    'info.address_label': '所在地', 'info.address': '青森県青森市新町2-3-1',
    'info.name_label': '店名', 'info.name': '炉 RO',
    'info.hours_label': '営業時間', 'info.hours': '18:00 — 23:00',
    'info.closed_label': '定休日', 'info.closed': '月曜・火曜',
    'info.seats_label': '席数', 'info.seats': 'カウンター8席 / 完全予約制\n炉を囲む一体感を大切にするため、個室のご用意はございません',
    'info.payment_label': 'お支払い', 'info.payment': '現金・各種カード',
    'info.tel_label': 'お問合せ',
    'reserve.desc': '当店は完全予約制です。\nご予約は3日前までにお願いいたします。\nアレルギーや食の制限についても、ご予約時にお知らせください。',
    'reserve.online': 'Online Reservation',
    'reserve.label': '予約',
  },
  en: {
    'nav.concept': 'Concept', 'nav.menu': 'Menu', 'nav.space': 'Space',
    'nav.access': 'Access', 'nav.reserve': 'Reservation',
    'hero.eyebrow': 'Aomori, Japan',
    'hero.desc': "Tsugaru's brief summers concentrate the land into flavour.\nCharcoal draws it out, slow as snowmelt.\nAn evening to simply listen to what the ingredients say.",
    'hero.cta': 'Our Story',
    'concept.label': '— Our Philosophy',
    'concept.title': 'Fire & Microbes\ncraft time itself',
    'concept.p1': 'The far-infrared warmth of Tsugaru binchōtan gently opens each ingredient, meeting the umami drawn out through long fermentation. We believe this is not cooking — it is the crystallisation of time.',
    'concept.p2': 'Only ingredients grown in the mountains and sea of Aomori. Only fermented condiments made without additives. The simpler the form, the clearer the memory of the ingredient.',
    'concept.caption': 'Tsugaru binchōtan, 800°C of silence',
    'menu.subtitle': 'Omakase Menu', 'menu.title': 'Tasting Menu',
    'menu.link': 'Full Menu →',
    'menu.preview_hint': 'Hover over a dish\nto see full details',
    'menu.hover_hint': 'Hover to see details',
    'menu.course': 'A 6-course omakase of seasonal ingredients. ¥30,000 per person (tax incl.). Drink pairings and special ingredient requests available upon reservation.',
    'space.subtitle': 'Space & Atmosphere', 'space.title': 'Our Space',
    'space.p1': 'Counter seats around the hearth', 'space.p2': 'From Aomori\'s mountains and sea',
    'space.p3': 'Tsugaru binchōtan flame', 'space.p4': 'Where fermentation meets fire',
    'info.label': '— Restaurant Info',
    'info.address_label': 'Address', 'info.address': '2-3-1 Shinmachi, Aomori',
    'info.name_label': 'Name', 'info.name': '炉 RO',
    'info.hours_label': 'Hours', 'info.hours': '18:00 — 23:00',
    'info.closed_label': 'Closed', 'info.closed': 'Mon & Tue',
    'info.seats_label': 'Seats', 'info.seats': '8 counter seats / Reservation only\nNo private rooms — we cherish the shared intimacy of gathering around the hearth.',
    'info.payment_label': 'Payment', 'info.payment': 'Cash & Cards',
    'info.tel_label': 'Enquiries',
    'reserve.desc': 'We are reservation-only.\nPlease book at least 3 days in advance.\nKindly inform us of any dietary requirements at the time of booking.',
    'reserve.online': 'Online Reservation',
    'reserve.label': 'Reserve',
    'tax': 'tax incl.',
    'tax': 'tax incl.',
  },
  'zh-hans': {
    'nav.concept': '理念', 'nav.menu': '菜单', 'nav.space': '空间',
    'nav.access': '指南', 'nav.reserve': '预约',
    'hero.eyebrow': '日本 青森',
    'hero.desc': '津轻炭火的温度，\n与精心发酵的时间之味交汇。\n只是静静聆听，食材诉说的夜晚。',
    'hero.cta': '了解我们',
    'concept.label': '— 我们的理念',
    'concept.title': '火与菌，\n酿造时间',
    'concept.p1': '津轻备长炭的远红外线，温柔地打开食材的细胞，与长期发酵引出的鲜味相遇的瞬间，我们认为那不是料理，而是时间的结晶。',
    'concept.p2': '只使用青森山海孕育的食材，以不含任何添加物的发酵调味料收尾。越是简单，食材的记忆越是清晰。',
    'concept.caption': '津轻备长炭，800°C的静寂',
    'menu.subtitle': '怀石套餐', 'menu.title': '主厨精选',
    'menu.link': '查看完整菜单 →',
    'menu.preview_hint': '将鼠标悬停在菜品上\n可查看详细信息',
    'menu.hover_hint': '悬停查看详情',
    'menu.course': '主厨精选套餐，以时令食材精心呈现6道菜，每位¥30,000（含税）。饮品搭配及食材要求，请于预约时咨询。',
    'space.subtitle': '空间与氛围', 'space.title': '关于空间',
    'space.p1': '围炉而坐，吧台席位', 'space.p2': '来自青森的山与海',
    'space.p3': '津轻备长炭之火', 'space.p4': '发酵与炭火的交汇',
    'info.label': '— 店铺信息',
    'info.address_label': '地址', 'info.address': '青森县青森市新町2-3-1',
    'info.name_label': '店名', 'info.name': '炉 RO',
    'info.hours_label': '营业时间', 'info.hours': '18:00 — 23:00',
    'info.closed_label': '定休日', 'info.closed': '周一·周二',
    'info.seats_label': '座位数', 'info.seats': '吧台8席 / 仅限预约\n为珍视围炉而坐的共同体验，恕不设包厢。',
    'info.payment_label': '付款方式', 'info.payment': '现金及各类卡',
    'info.tel_label': '联系方式',
    'reserve.desc': '本店仅接受预约。\n请于3天前完成预约。\n预约时请告知过敏或饮食限制。',
    'reserve.online': '在线预约',
    'reserve.label': '预约',
  },
  'zh-hant': {
    'nav.concept': '理念', 'nav.menu': '菜單', 'nav.space': '空間',
    'nav.access': '指南', 'nav.reserve': '預約',
    'hero.eyebrow': '日本 青森',
    'hero.desc': '津輕炭火的溫度，\n與精心發酵的時間之味交匯。\n只是靜靜聆聽，食材訴說的夜晚。',
    'hero.cta': '瞭解我們',
    'concept.label': '— 我們的理念',
    'concept.title': '火與菌，\n釀造時間',
    'concept.p1': '津輕備長炭的遠紅外線，溫柔地打開食材的細胞，與長期發酵引出的鮮味相遇的瞬間，我們認為那不是料理，而是時間的結晶。',
    'concept.p2': '只使用青森山海孕育的食材，以不含任何添加物的發酵調味料收尾。越是簡單，食材的記憶越是清晰。',
    'concept.caption': '津輕備長炭，800°C的靜寂',
    'menu.subtitle': '懷石套餐', 'menu.title': '主廚精選',
    'menu.link': '查看完整菜單 →',
    'menu.preview_hint': '將滑鼠懸停在菜品上\n可查看詳細資訊',
    'menu.hover_hint': '懸停查看詳情',
    'menu.course': '主廚精選套餐，以時令食材精心呈現6道菜，每位¥30,000（含稅）。飲品搭配及食材要求，請於預約時洽詢。',
    'space.subtitle': '空間與氛圍', 'space.title': '關於空間',
    'space.p1': '圍爐而坐，吧台席位', 'space.p2': '來自青森的山與海',
    'space.p3': '津輕備長炭之火', 'space.p4': '發酵與炭火的交匯',
    'info.label': '— 店鋪資訊',
    'info.address_label': '地址', 'info.address': '青森縣青森市新町2-3-1',
    'info.name_label': '店名', 'info.name': '炉 RO',
    'info.hours_label': '營業時間', 'info.hours': '18:00 — 23:00',
    'info.closed_label': '定休日', 'info.closed': '週一・週二',
    'info.seats_label': '座位數', 'info.seats': '吧台8席 / 僅限預約\n為珍視圍爐而坐的共同體驗，恕不設包廂。',
    'info.payment_label': '付款方式', 'info.payment': '現金及各類卡',
    'info.tel_label': '聯絡方式',
    'reserve.desc': '本店僅接受預約。\n請於3天前完成預約。\n預約時請告知過敏或飲食限制。',
    'reserve.online': '線上預約',
    'reserve.label': '預約',
  },
  ko: {
    'nav.concept': '개념', 'nav.menu': '메뉴', 'nav.space': '공간',
    'nav.access': '안내', 'nav.reserve': '예약',
    'hero.eyebrow': '일본 아오모리',
    'hero.desc': '쓰가루 숯불의 온기와,\n시간을 들여 발효시킨 맛의 깊이.\n식재료가 전하는 이야기에 귀 기울이는 밤.',
    'hero.cta': '스토리 읽기',
    'concept.label': '— 우리의 철학',
    'concept.title': '불과 균이\n빚어내는 시간',
    'concept.p1': '쓰가루 빈초탄의 원적외선이 식재료의 세포를 부드럽게 열고, 장기 발효가 이끌어낸 감칠맛과 만나는 순간이 있습니다. 그것은 요리가 아니라 시간의 결정이라고 저희는 생각합니다.',
    'concept.p2': '아오모리의 산과 바다가 키운 식재료만을 사용하고, 첨가물이 전혀 없는 발효 조미료로 마무리합니다. 단순할수록 식재료의 기억은 선명해집니다.',
    'concept.caption': '쓰가루 빈초탄, 800°C의 정적',
    'menu.subtitle': '오마카세 메뉴', 'menu.title': '주방장 추천',
    'menu.link': '전체 메뉴 →',
    'menu.preview_hint': '메뉴에 마우스를 올리면\n상세 정보를 확인하실 수 있습니다',
    'menu.hover_hint': '마우스를 올리면 상세 정보를 확인할 수 있습니다',
    'menu.course': '제철 식재료로 구성한 오마카세 코스 6가지 요리、1인 ¥30,000（세금 포함）。드링크 페어링 및 식재료 요청은 예약 시 상담해 드립니다。',
    'space.subtitle': '공간과 분위기', 'space.title': '공간 소개',
    'space.p1': '화로를 둘러싼 카운터석', 'space.p2': '아오모리의 산과 바다에서',
    'space.p3': '쓰가루 빈초탄의 불꽃', 'space.p4': '발효와 숯불의 교차점',
    'info.label': '— 레스토랑 정보',
    'info.address_label': '주소', 'info.address': '아오모리현 아오모리시 신마치 2-3-1',
    'info.name_label': '상호명', 'info.name': '炉 RO',
    'info.hours_label': '영업시간', 'info.hours': '18:00 — 23:00',
    'info.closed_label': '정기휴일', 'info.closed': '월·화요일',
    'info.seats_label': '좌석 수', 'info.seats': '카운터 8석 / 완전 예약제\n화로를 둘러싼 일체감을 소중히 여기므로 개인실은 마련되어 있지 않습니다。',
    'info.payment_label': '결제 방법', 'info.payment': '현금 및 각종 카드',
    'info.tel_label': '문의',
    'reserve.desc': '저희는 완전 예약제입니다.\n3일 전까지 예약 부탁드립니다.\n알레르기나 식이 제한이 있으신 분은 예약 시 알려주세요.',
    'reserve.online': '온라인 예약',
    'reserve.label': '예약',
  }
};

// ==================
// MENU DATA
// ==================
const menuData = [
  {
    number: '01',
    ja: { name: '先付け', nameEn: 'Sakizuke', desc: '津軽味噌を三年熟成させた出汁で浸けた、旬の野菜と地魚の前菜。季節によって表情が変わる。', price: '¥2,800' },
    en: { name: 'Sakizuke', nameEn: 'Seasonal Appetiser', desc: 'Seasonal vegetables and local fish marinated in dashi made from three-year-aged Tsugaru miso. The expression changes with each season.', price: '¥2,800' },
    'zh-hans': { name: '先付', nameEn: 'Sakizuke', desc: '用三年熟成的津轻味噌出汁腌渍的当季蔬菜与地方鱼鲜前菜。随季节变换呈现不同风貌。', price: '¥2,800' },
    'zh-hant': { name: '先付', nameEn: 'Sakizuke', desc: '以三年熟成的津輕味噌出汁醃漬的當季蔬菜與地方魚鮮前菜。隨季節變換呈現不同風貌。', price: '¥2,800' },
    ko: { name: '사키즈케', nameEn: 'Sakizuke', desc: '3년 숙성 쓰가루 된장 다시에 절인 제철 채소와 지역 생선 전채. 계절마다 다른 표정을 선사합니다.', price: '¥2,800' },
    img: 'https://images.unsplash.com/photo-1547592180-85f173990554?w=600&q=80'
  },
  {
    number: '02',
    ja: { name: '炭火造り', nameEn: 'Charcoal Sashimi', desc: '陸奥湾の天然ヒラメを炭火でわずかに炙り、発酵醤油と青森りんご酢のポン酢で。', price: '¥4,200' },
    en: { name: 'Charcoal Sashimi', nameEn: 'Lightly seared flounder', desc: 'Wild flounder from Mutsu Bay, lightly seared over charcoal and served with ponzu made from fermented soy and Aomori apple vinegar.', price: '¥4,200' },
    'zh-hans': { name: '炭烤刺身', nameEn: 'Charcoal Sashimi', desc: '陆奥湾天然比目鱼轻炙炭火，配以发酵酱油与青森苹果醋调制的柚子醋。', price: '¥4,200' },
    'zh-hant': { name: '炭烤刺身', nameEn: 'Charcoal Sashimi', desc: '陸奧灣天然比目魚輕炙炭火，配以發酵醬油與青森蘋果醋調製的柚子醋。', price: '¥4,200' },
    ko: { name: '숯불 사시미', nameEn: 'Charcoal Sashimi', desc: '무쓰만의 천연 광어를 숯불에 살짝 구워, 발효 간장과 아오모리 사과식초 폰즈와 함께.', price: '¥4,200' },
    img: 'https://images.unsplash.com/photo-1579584425555-c3ce17fd4351?w=600&q=80'
  },
  {
    number: '03',
    ja: { name: '炉端焼き', nameEn: 'Robatayaki', desc: '南部牛のシャトーブリアンを備長炭の遠赤外線でゆっくりと。麹塩と共に。', price: '¥9,800' },
    en: { name: 'Robatayaki', nameEn: 'Hearth-grilled beef', desc: 'Chateaubriand of Nanbu beef, slowly cooked in the far-infrared heat of binchōtan charcoal. Served with koji salt.', price: '¥9,800' },
    'zh-hans': { name: '炉端烤肉', nameEn: 'Robatayaki', desc: '南部牛里脊在备长炭远红外线下缓慢炙烤，搭配麹盐食用。', price: '¥9,800' },
    'zh-hant': { name: '爐端燒肉', nameEn: 'Robatayaki', desc: '南部牛里脊在備長炭遠紅外線下緩慢炙烤，搭配麹鹽食用。', price: '¥9,800' },
    ko: { name: '로바타야키', nameEn: 'Robatayaki', desc: '남부 소 샤토브리앙을 빈초탄 원적외선으로 천천히 구운 요리. 누룩 소금과 함께.', price: '¥9,800' },
    img: 'https://images.unsplash.com/photo-1558030006-450675393462?w=600&q=80'
  },
  {
    number: '04',
    ja: { name: '発酵鍋', nameEn: 'Fermented Nabe', desc: '二年熟成の津軽味噌と甘酒を合わせた白湯仕立て。陸奥湾のホタテと山菜を添えて。', price: '¥5,600' },
    en: { name: 'Fermented Nabe', nameEn: 'Hot pot', desc: 'A white broth combining two-year-aged Tsugaru miso and amazake. Served with scallops from Mutsu Bay and mountain vegetables.', price: '¥5,600' },
    'zh-hans': { name: '发酵火锅', nameEn: 'Fermented Nabe', desc: '二年熟成津轻味噌与甘酒调制的白汤。配以陆奥湾扇贝和山野菜。', price: '¥5,600' },
    'zh-hant': { name: '發酵火鍋', nameEn: 'Fermented Nabe', desc: '二年熟成津輕味噌與甘酒調製的白湯，配以陸奧灣扇貝和山野菜。', price: '¥5,600' },
    ko: { name: '발효 나베', nameEn: 'Fermented Nabe', desc: '2년 숙성 쓰가루 된장과 아마자케를 합친 백탕. 무쓰만 가리비와 산나물을 곁들여.', price: '¥5,600' },
    img: 'https://images.unsplash.com/photo-1569050467447-ce54b3bbc37d?w=600&q=80'
  },
  {
    number: '05',
    ja: { name: '炭焼き飯', nameEn: 'Charcoal Rice', desc: '南部鉄器の羽釜で炊いた青森産つがるロマンに、炭火で焼いた塩むすびを添えて締める。', price: '¥1,800' },
    en: { name: 'Charcoal Rice', nameEn: 'Rice finale', desc: 'Tsugaru Roman rice from Aomori, cooked in a Nambu ironware pot, accompanied by a salt rice ball grilled over charcoal.', price: '¥1,800' },
    'zh-hans': { name: '炭烤饭', nameEn: 'Charcoal Rice', desc: '南部铁器羽釜炊制的青森产津轻罗曼米，搭配炭火烤制的盐饭团收尾。', price: '¥1,800' },
    'zh-hant': { name: '炭烤飯', nameEn: 'Charcoal Rice', desc: '南部鐵器羽釜炊製的青森産津輕羅曼米，搭配炭火烤製的鹽飯糰收尾。', price: '¥1,800' },
    ko: { name: '숯불 밥', nameEn: 'Charcoal Rice', desc: '남부 철기 하고마에서 지은 아오모리산 쓰가루 로만 쌀밥. 숯불에 구운 소금 주먹밥으로 마무리.', price: '¥1,800' },
    img: 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=600&q=80'
  },
  {
    number: '06',
    ja: { name: '水菓子', nameEn: 'Mizugashi', desc: '青森りんごを発酵させたソルベと、白神山地の湧き水で炊いた甘酒のジュレ。', price: '¥1,600' },
    en: { name: 'Mizugashi', nameEn: 'Dessert', desc: 'Sorbet of fermented Aomori apple, with a gelée of amazake made from the spring water of the Shirakami Mountains.', price: '¥1,600' },
    'zh-hans': { name: '水果子', nameEn: 'Mizugashi', desc: '青森苹果发酵冰糕，搭配以白神山地泉水熬制的甘酒果冻。', price: '¥1,600' },
    'zh-hant': { name: '水果子', nameEn: 'Mizugashi', desc: '青森蘋果發酵雪酪，搭配以白神山地泉水熬製的甘酒果凍。', price: '¥1,600' },
    ko: { name: '미즈가시', nameEn: 'Mizugashi', desc: '아오모리 사과 발효 소르베와 시라카미 산지 용천수로 끓인 아마자케 젤리.', price: '¥1,600' },
    img: 'https://images.unsplash.com/photo-1488477181946-6428a0291777?w=600&q=80'
  }
];

// ==================
// STATE
// ==================
let currentLang = 'ja';

// ==================
// RENDER MENU
// ==================
function renderMenu() {
  const grid = document.getElementById('menuGrid');
  grid.innerHTML = menuData.map((item, i) => {
    const d = item[currentLang] || item.ja;
    return `
      <div class="menu-item" data-index="${i}" style="position:relative;">
        <div class="menu-item-toggle"></div>
        <div class="menu-item-image">
          <img src="${item.img}" alt="${d.name}" loading="lazy">
        </div>
        <p class="menu-number">${item.number}</p>
        <p class="menu-name-ja">${d.name}</p>
        <p class="menu-name-en">${d.nameEn}</p>
        <span class="menu-item-hover-hint">${i18n[currentLang]['menu.hover_hint'] || 'カーソルを合わせると詳細が開きます'}</span>
        <span class="menu-item-tap-hint">${i18n[currentLang]['menu.tap_hint'] || 'タップで詳細が開きます'}</span>
        <div class="menu-accordion-body">
          <div class="menu-accordion-content">
            <p class="menu-accordion-desc">${d.desc}</p>
            <p class="menu-accordion-price">${d.price} <small>税込</small></p>
          </div>
        </div>
      </div>
    `;
  }).join('');

  grid.querySelectorAll('.menu-item').forEach(el => {
    // デスクトップ: hover でプレビュー
    el.addEventListener('mouseenter', () => {
      if (window.innerWidth > 900) showPreview(parseInt(el.dataset.index));
    });
    el.addEventListener('mouseleave', () => {
      if (window.innerWidth > 900) hidePreview();
    });
    // モバイル: click でアコーディオン
    el.addEventListener('click', () => {
      if (window.innerWidth <= 900) {
        const isOpen = el.classList.contains('accordion-open');
        grid.querySelectorAll('.menu-item').forEach(e => e.classList.remove('accordion-open'));
        if (!isOpen) el.classList.add('accordion-open');
      }
    });
  });
}

function showPreview(index) {
  const item = menuData[index];
  const d = item[currentLang] || item.ja;
  const preview = document.getElementById('menuPreview');

  preview.innerHTML = `
    <div class="menu-preview-image">
      <img src="${item.img}" alt="${d.name}">
    </div>
    <div class="menu-preview-body">
      <p class="menu-preview-number">${item.number}</p>
      <p class="menu-preview-name">${d.name}</p>
      <span class="menu-preview-name-en">${d.nameEn}</span>
      <p class="menu-preview-desc">${d.desc}</p>
      <p class="menu-preview-price">${d.price} <small>${i18n[currentLang]['tax'] || '\u7a0e\u8fbc'}</small></p>
    </div>
  `;

  document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.menu-item')[index].classList.add('active');
}

function hidePreview() {
  document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
  const preview = document.getElementById('menuPreview');
  preview.innerHTML = `
    <div class="menu-preview-placeholder">
      <p>${(i18n[currentLang]['menu.preview_hint'] || '').replace('\n', '<br>')}</p>
    </div>
  `;
}

// ==================
// I18N APPLY
// ==================
function applyLang(lang) {
  currentLang = lang;
  const dict = i18n[lang] || i18n.ja;

  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (dict[key]) {
      el.innerHTML = dict[key].replace(/\n/g, '<br>');
    }
  });

  // reserve-block label
  const reserveBlock = document.getElementById('reserve');
  if (reserveBlock && dict['reserve.label']) {
    reserveBlock.setAttribute('data-label', dict['reserve.label']);
  }

  // body class for font
  document.body.className = document.body.className.replace(/lang-\S+/g, '').trim();
  document.body.classList.add(`lang-${lang}`);

  // active button
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.lang === lang);
  });

  renderMenu();
  hidePreview();
}

// ==================
// HERO SLIDESHOW
// ==================
const slides = document.querySelectorAll('.hero-slide');
const indicators = document.querySelectorAll('.hero-indicator');
let currentSlide = 0;
let slideTimer;

function goToSlide(n) {
  slides[currentSlide].classList.remove('active');
  indicators[currentSlide].classList.remove('active');
  currentSlide = n;
  slides[currentSlide].classList.add('active');
  indicators[currentSlide].classList.add('active');
}

function nextSlide() {
  goToSlide((currentSlide + 1) % slides.length);
}

function startSlideshow() {
  slideTimer = setInterval(nextSlide, 8000);
}

indicators.forEach(ind => {
  ind.addEventListener('click', () => {
    clearInterval(slideTimer);
    goToSlide(parseInt(ind.dataset.index));
    startSlideshow();
  });
});

// Trigger first indicator animation after load
setTimeout(() => {
  indicators[0].classList.add('active');
  startSlideshow();
}, 100);

// ==================
// SECTION DIMMING
// ==================
const dimmables = document.querySelectorAll('.section-dimmable');

const dimObserver = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      dimmables.forEach(s => {
        s.classList.remove('active');
        s.classList.add('dimmed');
      });
      entry.target.classList.remove('dimmed');
      entry.target.classList.add('active');
    }
  });
}, { threshold: 0.3 });

dimmables.forEach(s => {
  s.classList.add('dimmed');
  dimObserver.observe(s);
});

// ==================
// SCROLL REVEAL
// ==================
const reveals = document.querySelectorAll('.reveal');
const revealObserver = new IntersectionObserver(entries => {
  entries.forEach(e => {
    if (e.isIntersecting) {
      e.target.classList.add('visible');
      revealObserver.unobserve(e.target);
    }
  });
}, { threshold: 0.1 });
reveals.forEach(r => revealObserver.observe(r));

// ==================
// HAMBURGER
// ==================
const hamburger = document.getElementById('hamburger');
const mobileMenu = document.getElementById('mobileMenu');
const langSwitcher = document.querySelector('.lang-switcher');

hamburger.addEventListener('click', () => {
  const isOpen = hamburger.classList.toggle('open');
  mobileMenu.classList.toggle('open', isOpen);
  document.body.style.overflow = isOpen ? 'hidden' : '';
  if (langSwitcher) langSwitcher.classList.toggle('hidden', isOpen);
});

const closeBtn = document.getElementById('mobileMenuClose');
if (closeBtn) {
  closeBtn.addEventListener('click', () => {
    hamburger.classList.remove('open');
    mobileMenu.classList.remove('open');
    document.body.style.overflow = '';
    if (langSwitcher) langSwitcher.classList.remove('hidden');
  });
}

mobileMenu.querySelectorAll('a').forEach(a => {
  a.addEventListener('click', () => {
    hamburger.classList.remove('open');
    mobileMenu.classList.remove('open');
    document.body.style.overflow = '';
    if (langSwitcher) langSwitcher.classList.remove('hidden');
  });
});

// ==================
// LANG BUTTONS
// ==================
document.querySelectorAll('.lang-btn').forEach(btn => {
  btn.addEventListener('click', () => applyLang(btn.dataset.lang));
});

// ==================
// CURSOR
// ==================
const cursor = document.getElementById('cursor');
const ring = document.getElementById('cursorRing');
let mx = 0, my = 0, rx = 0, ry = 0;

document.addEventListener('mousemove', e => { mx = e.clientX; my = e.clientY; });

function animCursor() {
  cursor.style.left = mx + 'px';
  cursor.style.top = my + 'px';
  rx += (mx - rx) * 0.12;
  ry += (my - ry) * 0.12;
  ring.style.left = rx + 'px';
  ring.style.top = ry + 'px';
  requestAnimationFrame(animCursor);
}
animCursor();

document.querySelectorAll('a, button, .menu-item, .photo-strip-item').forEach(el => {
  el.addEventListener('mouseenter', () => {
    cursor.style.transform = 'translate(-50%,-50%) scale(2)';
    ring.style.transform = 'translate(-50%,-50%) scale(1.5)';
  });
  el.addEventListener('mouseleave', () => {
    cursor.style.transform = 'translate(-50%,-50%) scale(1)';
    ring.style.transform = 'translate(-50%,-50%) scale(1)';
  });
});

// ==================
// INIT
// ==================
applyLang('ja');
